<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Calcio a 5</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Resetta gli stili predefiniti */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Variabili di stile */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
            --light-bg: #f8f9fa;
            --dark-bg: #e9ecef;
            --text-color: #333;
            --white: #fff;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-color);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            color: var(--secondary-color);
            margin-bottom: 30px;
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .menu {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }


        .menu button {
            padding: 12px 25px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            background-color: var(--primary-color);
            color: var(--white);
            cursor: pointer;
            margin: 0 10px;
            transition: background-color 0.3s ease;
        }

        .menu button:hover {
            background-color: #2980b9;
        }

        /* Stili per la sezione principale */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        .players-section, .team-section, .rankings-section {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .players-section h2, .team-section h3, .rankings-section h2 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
        }

        /* Stili per la lista dei giocatori */
        .player-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--light-bg) 0%, var(--dark-bg) 100%);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .player-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            border-color: var(--primary-color);
        }

        .player-card.selected {
            background: linear-gradient(135deg, var(--primary-color) 0%, #2980b9 100%);
            color: var(--white);
            transform: scale(1.02);
            box-shadow: 0 10px 25px rgba(52, 152, 219, 0.3);
        }

        .player-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f1f2f6;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: bold;
            font-size: 18px;
        }

        .player-card.selected .player-avatar {
            background: rgba(255, 255, 255, 0.2);
        }

        .player-name {
            font-weight: 500;
            font-size: 1.1rem;
        }

        .player-cost {
            background: var(--error-color);
            color: var(--white);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1rem;
            min-width: 60px;
            text-align: center;
        }

        .player-card.selected .player-cost {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Stili per la sezione del team */
        .budget-info {
            background: linear-gradient(135deg, var(--success-color) 0%, #27ae60 100%);
            color: var(--white);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            text-align: center;
        }

        .budget-info h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .budget-display {
            font-size: 2rem;
            font-weight: bold;
        }

        .team-list {
            min-height: 200px;
            margin-bottom: 20px;
        }

        .team-list h3 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .selected-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: linear-gradient(135deg, var(--light-bg) 0%, var(--dark-bg) 100%);
            border-radius: var(--border-radius);
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .selected-player:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow);
        }

        .remove-btn {
            background: var(--error-color);
            color: var(--white);
            border: none;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .remove-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        /* Stili per i pulsanti di azione */
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-reset {
            background: var(--error-color);
            color: var(--white);
        }

        .btn-reset:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.3);
        }

        .btn-save {
            background: linear-gradient(135deg, var(--primary-color) 0%, #2980b9 100%);
            color: var(--white);
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Stili per l'immagine della squadra */
        .team-image {
            display: none;
            position: fixed;
            top: -9999px;
            left: -9999px;
            width: 800px;
            height: 1000px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 40px;
            color: var(--white);
            text-align: center;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .team-image h2 {
            font-size: 3rem;
            margin-bottom: 40px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            font-weight: 700;
        }

        .formation {
            display: flex;
            flex-direction: column;
            gap: 30px;
            min-height: 600px;
            position: relative;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(5px);
            justify-content: space-between;
        }

        .position-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .player-slot {
            background: rgba(255, 255, 255, 0.25);
            border: 3px solid rgba(255, 255, 255, 0.4);
            border-radius: 20px;
            padding: 20px 25px;
            color: var(--white);
            font-weight: bold;
            text-align: center;
            width: 280px;
            height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .player-slot .player-name {
            font-size: 1.4rem;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .player-slot .player-cost {
            font-size: 1.1rem;
            opacity: 0.9;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 15px;
        }

        .total-cost {
            background: rgba(255, 255, 255, 0.25);
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: center;
            font-size: 1.6rem;
            font-weight: bold;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        /* Stili per le notifiche */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success-color);
            color: var(--white);
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: var(--error-color);
        }

        /* Stili per le classifiche */
        .ranking-list {
            list-style: none;
            padding: 0;
        }

        .ranking-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px; /* spazio tra nome e punteggio */
            font-size: 0.95rem;
            padding: 8px 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }


        .ranking-list li:last-child {
            border-bottom: none;
        }

        /* Style for the media selection dropdown */
        #sort-by {
            margin-left: 10px;
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
        }

        /* Style for the ranking section */
        .rankings-section {
            display: none; /* Hidden by default */
        }

        /* Style to show the ranking section */
        .rankings-section.active {
            display: block;
        }

        /* Styles for the ranking type selection */
        .ranking-type-selection {
            margin-bottom: 20px;
            text-align: center;
        }

        .ranking-type-selection label {
            margin-right: 10px;
            font-weight: bold;
        }

        .ranking-type-selection select {
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            h1 {
                font-size: 1.8rem;
                margin-bottom: 15px;
            }

            .main-content {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .players-section, .team-section, .rankings-section {
                padding: 15px;
            }

            .menu button {
                margin: 5px 5px;
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            .player-card {
                flex-direction: column;
                align-items: flex-start;
            }

            .player-cost {
                margin-top: 8px;
            }

            .team-list {
                min-height: auto;
            }

            .selected-player {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .ranking-list li {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .ranking-type-selection,
            .rankings-container {
                font-size: 0.9rem;
            }

            #sort-by, #ranking-type {
                width: 100%;
                margin-top: 10px;
            }

            .btn {
                font-size: 0.85rem;
                padding: 10px;
            }

            footer {
                font-size: 0.85rem;
            }
        }


        /* Stile per il footer */
        footer {
            text-align: center;
            margin-top: 30px;
            color: var(--white);
            padding: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
    <h1>Fantasy Calcio a 5</h1>

        <div class="menu">
            <button onclick="showSection('teamBuilder')">Team Builder</button>
            <button onclick="showSection('rankings')">Classifiche</button>
        </div>

        <div id="teamBuilder" class="section">
            <div class="main-content">
                <div class="players-section">
                    <h2>👥 Giocatori Disponibili</h2>
                    <div id="playersList"></div>
                </div>

                <div class="team-section">
                    <div class="budget-info">
                        <h3>💰 Budget Rimanente</h3>
                        <div class="budget-display"><span id="remainingBudget">25</span> crediti</div>
                    </div>

                    <div class="team-list">
                        <h3>🏆 La Tua Squadra (<span id="teamCount">0</span>/5)</h3>
                        <div id="selectedPlayers"></div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-reset" onclick="resetTeam()">🔄 Reset</button>
                        <button class="btn btn-save" id="saveBtn" onclick="saveTeamImage()" disabled>💾 Salva Immagine</button>
                    </div>
                </div>
            </div>

            <div class="team-image" id="teamImage">
                <h2>🏆 LA MIA SQUADRA</h2>
                <div class="formation" id="formation"></div>
                <div class="total-cost">
                    Costo Totale: <span id="totalCostDisplay">0</span> crediti
                </div>
            </div>
        </div>

        <div id="rankings" class="rankings-section section">
            <h2>🏆 Classifiche</h2>

            <div class="ranking-type-selection">
                <label for="ranking-type">Tipo di Classifica:</label>
                <select id="ranking-type" onchange="renderRankings()">
                    <option value="weekly">Settimanale</option>
                    <option value="global">Globale</option>
                </select>
            </div>

            <div class="rankings-container">
                <!-- Classifica Squadre -->
                <div class="team-rankings">
                    <h3>Classifica Squadre</h3>
                    <ul class="ranking-list" id="teamRankingList"></ul>
                </div>
                <br> <br>
                <!-- Classifica Giocatori -->
                <div class="player-rankings">
                    <h3>Classifica Giocatori</h3>
                    <label for="sort-by">Ordina per:</label>
                    <select id="sort-by" onchange="sortPlayersRanking()">
                        <option value="points">Punteggio</option>
                        <option value="average">Media</option>
                    </select>
                    <ul class="ranking-list" id="playerRankingList"></ul>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <footer>
        &copy; 2025 Fantasy Calcio a 5 - Bob Difensore 7
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // Dati dei giocatori
        const players = [
            { name: "Luigi Pedone", cost: 9 },
            { name: "Gianni Destino", cost: 8 },
            { name: "Giuseppe Acquaviva", cost: 7 },
            { name: "Francesco Matarrese", cost: 7 },
            { name: "Domenico Patruno", cost: 6 },
            { name: "Mariano Di Nicoli", cost: 5 },
            { name: "Simone Palermo", cost: 4 },
            { name: "Luca Di Muro", cost: 3 },
            { name: "Leo Acquaviva", cost: 3 },
            { name: "Biagio Barbarossa", cost: 3 },
            { name: "Nicola Iacobone", cost: 2 },
            { name: "Luca 'Bob' Del Vento", cost: 2 }
        ];

        // Dati delle Classifiche (iniziali)
        const weeklyTeamRankingData = [
            { name: "PEDONE", score: 14 },
            { name: "DI NICOLI", score: 13.5 },
            { name: "DI MURO", score: 13.5 },
            { name: "IACOBONE", score: 13.5 },
            { name: "MATARRESE", score: 13 },
            { name: "PALERMO", score: 13 },
            { name: "DESTINO", score: 11.5 },
            { name: "BARBAROSSA", score: 11.5 },
            { name: "ACQUAVIVA", score: 10.5 },
            { name: "DEL VENTO", score: 10 },
            { name: "PATRUNO", score: 8.5 }
        ];

        const globalTeamRankingData = [
            { name: "PEDONE", score: 14 },
            { name: "DI NICOLI", score: 13.5 },
            { name: "DI MURO", score: 13.5 },
            { name: "IACOBONE", score: 13.5 },
            { name: "MATARRESE", score: 13 },
            { name: "PALERMO", score: 13 },
            { name: "DESTINO", score: 11.5 },
            { name: "BARBAROSSA", score: 11.5 },
            { name: "ACQUAVIVA", score: 10.5 },
            { name: "DEL VENTO", score: 10 },
            { name: "PATRUNO", score: 8.5 }
        ];

        const weeklyPlayerRankingData = [
            { name: "Destino G.", score: 6.5, matches: 1 },
            { name: "Matarrese F.", score: 6.0, matches: 1},
            { name: "Pedone L.", score: 2.0, matches: 1 },
            { name: "Acquaviva G.", score: 3.5, matches: 1 },
            { name: "Di Nicoli M.", score: 2.5, matches: 1 },
            { name: "Patruno D.", score: 1.5, matches: 1 },
            { name: "Di Muro L.", score: 1.5, matches: 1 },
            { name: "Barbarossa B.", score: 1.5, matches: 1 },
            { name: "Iacobone N.", score: 0.0, matches: 1 },
            { name: "Del Vento L.", score: 2.5, matches: 1 }
        ];

        const globalPlayerRankingData = [
            { name: "Pedone L.", score: 19.0, matches: 4 },
            { name: "Destino G.", score: 18.5, matches: 4 },
            { name: "Acquaviva G.", score: 12.0, matches: 4 },
            { name: "Matarrese F.", score: 12.0, matches: 3 },
            { name: "Di Nicoli M.", score: 9.0, matches: 4 },
            { name: "Patruno D.", score: 7.5, matches: 4 },
            { name: "Palermo S.", score: 4.5, matches: 3 },
            { name: "Di Muro L.", score: 4.5, matches: 4 },
            { name: "Acquaviva L.", score: 2.0, matches: 1 },
            { name: "Barbarossa B.", score: 1.5, matches: 1 },
            { name: "Iacobone N.", score: 1.5, matches: 3 },
            { name: "Di Fazio L", score: 1.0, matches: 1 },
            { name: "Del Vento L.", score: -0.5, matches: 4 }
        ];

        // Variabili di stato
        let selectedPlayers = [];
        let remainingBudget = 25;

        // Funzioni di utilità
        function getInitials(name) {
            return name.split(' ').map(word => word[0]).join('').toUpperCase();
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Funzioni per la gestione della squadra
        function renderPlayers() {
            const playersList = document.getElementById('playersList');
            playersList.innerHTML = '';

            players.forEach((player, index) => {
                const isSelected = selectedPlayers.some(p => p.name === player.name);
                const canAfford = player.cost <= remainingBudget;
                const isDisabled = !isSelected && (!canAfford || selectedPlayers.length >= 5);

                const playerCard = document.createElement('div');
                playerCard.className = `player-card ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}`;
                playerCard.onclick = () => togglePlayer(player);

                playerCard.innerHTML = `
                    <div class="player-info">
                        <div class="player-avatar">${getInitials(player.name)}</div>
                        <div class="player-name">${player.name}</div>
                    </div>
                    <div class="player-cost">${player.cost}</div>
                `;

                playersList.appendChild(playerCard);
            });
        }

        function togglePlayer(player) {
            const isSelected = selectedPlayers.some(p => p.name === player.name);

            if (isSelected) {
                selectedPlayers = selectedPlayers.filter(p => p.name !== player.name);
                remainingBudget += player.cost;
            } else {
                if (selectedPlayers.length >= 5) {
                    showNotification('Hai già selezionato 5 giocatori!', 'error');
                    return;
                }
                if (player.cost > remainingBudget) {
                    showNotification('Budget insufficiente!', 'error');
                    return;
                }
                selectedPlayers.push(player);
                remainingBudget -= player.cost;
            }

            updateUI();
        }

        function renderSelectedPlayers() {
            const selectedPlayersDiv = document.getElementById('selectedPlayers');
            selectedPlayersDiv.innerHTML = '';

            if (selectedPlayers.length === 0) {
                selectedPlayersDiv.innerHTML = '<p style="text-align: center; color: #7f8c8d; font-style: italic;">Nessun giocatore selezionato</p>';
                return;
            }

            selectedPlayers.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'selected-player';
                playerDiv.innerHTML = `
                    <span><strong>${player.name}</strong> (${player.cost} crediti)</span>
                    <button class="remove-btn" onclick="togglePlayer({name: '${player.name}', cost: ${player.cost}})">✕</button>
                `;
                selectedPlayersDiv.appendChild(playerDiv);
            });
        }

        function resetTeam() {
            selectedPlayers = [];
            remainingBudget = 25;
            updateUI();
            showNotification('Squadra resettata!');
        }

        function updateUI() {
            document.getElementById('remainingBudget').textContent = remainingBudget;
            document.getElementById('teamCount').textContent = selectedPlayers.length;

            const saveBtn = document.getElementById('saveBtn');
            saveBtn.disabled = selectedPlayers.length !== 5;

            renderPlayers();
            renderSelectedPlayers();
        }

        function saveTeamImage() {
            if (selectedPlayers.length !== 5) {
                showNotification('Devi selezionare esattamente 5 giocatori!', 'error');
                return;
            }

            const teamImage = document.getElementById('teamImage');
            const formation = document.getElementById('formation');

            // Crea la formazione 2-1-1-1 (portiere - difensori - centrocampista - attaccante)
            formation.innerHTML = '';

            const positions = [
                { label: 'ATTACCANTE', players: 1 },
                { label: 'CENTROCAMPISTA', players: 1 },
                { label: 'CENTROCAMPISTA', players: 1 },
                { label: 'DIFENSORI', players: 2 }
            ];

            let playerIndex = 0;
            positions.forEach(position => {
                const row = document.createElement('div');
                row.className = 'position-row';

                for (let i = 0; i < position.players; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'player-slot';

                    if (playerIndex < selectedPlayers.length) {
                        const player = selectedPlayers[playerIndex];
                        slot.innerHTML = `
                            <div class="player-name">${player.name}</div>
                            <div class="player-cost">${player.cost} crediti</div>
                        `;
                        playerIndex++;
                    } else {
                        slot.innerHTML = `<div class="player-name">${position.label}</div>`;
                    }

                    row.appendChild(slot);
                }

                formation.appendChild(row);
            });

            const totalCost = selectedPlayers.reduce((sum, player) => sum + player.cost, 0);
            document.getElementById('totalCostDisplay').textContent = totalCost;

            // Mostra temporaneamente l'elemento per la cattura
            teamImage.style.display = 'block';
            teamImage.style.position = 'fixed';
            teamImage.style.top = '-9999px';
            teamImage.style.left = '-9999px';

            // Aspetta un momento per il rendering, poi cattura con impostazioni ottimizzate
            setTimeout(() => {
                html2canvas(teamImage, {
                    backgroundColor: null,
                    scale: 1,
                    width: 800,
                    height: 1000,
                    useCORS: true,
                    allowTaint: true,
                    logging: false,
                    scrollX: 0,
                    scrollY: 0,
                    windowWidth: 800,
                    windowHeight: 1000
                }).then(canvas => {
                    // Crea un canvas ottimizzato per mobile
                    const optimizedCanvas = document.createElement('canvas');
                    const ctx = optimizedCanvas.getContext('2d');

                    // Dimensioni ottimali per mobile (16:10 ratio)
                    optimizedCanvas.width = 800;
                    optimizedCanvas.height = 1000;

                    // Disegna l'immagine catturata sul canvas ottimizzato
                    ctx.fillStyle = '#667eea';
                    ctx.fillRect(0, 0, 800, 1000);
                    ctx.drawImage(canvas, 0, 0, 800, 1000);

                    // Scarica l'immagine ottimizzata
                    const link = document.createElement('a');
                    link.download = 'la_mia_squadra_calcio5.png';
                    link.href = optimizedCanvas.toDataURL('image/png', 1.0);

                    // Per mobile, usa un approccio diverso
                    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                        // Apri in una nuova finestra per mobile
                        const newWindow = window.open('', '_blank');
                        newWindow.document.write(`
                            <html>
                                <head>
                                    <title>La Mia Squadra</title>
                                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                                    <style>
                                        body { margin: 0; padding: 20px; text                                         img { max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
                                        .download-btn {
                                            display: inline-block;
                                            margin-top: 20px;
                                            padding: 15px 30px;
                                            background: #3498db;
                                            color: white;
                                            text-decoration: none;
                                            border-radius: 10px;
                                            font-weight: bold;
                                        }
                                    </style>
                                </head>
                                <body>
                                    <h2>🏆 La Tua Squadra è Pronta!</h2>
                                    <img src="${optimizedCanvas.toDataURL('image/png', 1.0)}" alt="La Mia Squadra">
                                    <br>
                                    <a href="${optimizedCanvas.toDataURL('image/png', 1.0)}" download="la_mia_squadra_calcio5.png" class="download-btn">
                                        📱 Salva Immagine
                                    </a>
                                    <p style="margin-top: 20px; color: #666;">
                                        Tieni premuto sull'immagine e seleziona "Salva immagine" dal menu
                                    </p>
                                </body>
                            </html>
                        `);
                    } else {
                        // Desktop: download diretto
                        link.click();
                    }

                    teamImage.style.display = 'none';
                    showNotification('Immagine creata con successo! 🎉');
                }).catch(err => {
                    console.error('Errore nel salvare l\'immagine:', err);
                    showNotification('Errore nel salvare l\'immagine', 'error');
                    teamImage.style.display = 'none';
                });
            }, 500);
        }

        // Funzioni per la gestione delle classifiche
        function renderTeamRanking(rankingType = 'weekly') {
            const teamRankingList = document.getElementById('teamRankingList');
            teamRankingList.innerHTML = '';

            const rankingData = (rankingType === 'weekly') ? weeklyTeamRankingData : globalTeamRankingData;

            rankingData.forEach(team => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span>${team.name}</span><span>${team.score}</span>`;
                teamRankingList.appendChild(listItem);
            });
        }

        function renderPlayerRanking(sortBy = 'points', rankingType = 'weekly') {
            const playerRankingList = document.getElementById('playerRankingList');
            playerRankingList.innerHTML = '';

            const rankingData = (rankingType === 'weekly') ? weeklyPlayerRankingData : globalPlayerRankingData;

            let sortedPlayers = [...rankingData];
            if (sortBy === 'points') {
                sortedPlayers.sort((a, b) => b.score - a.score);
            } else if (sortBy === 'average') {
                sortedPlayers.sort((a, b) => (b.score / b.matches) - (a.score / a.matches));
            }

            sortedPlayers.forEach(player => {
                const listItem = document.createElement('li');

                if (rankingType === 'weekly') {
                    // Solo nome e punteggio
                    listItem.innerHTML = `<span>${player.name}</span><span>${player.score}</span>`;
                } else {
                    // Nome, punteggio, partite e media
                    const average = (player.score / player.matches).toFixed(2);
                    listItem.innerHTML = `<span>${player.name}</span><span>${player.score} (${player.matches} partite, Media: ${average})</span>`;
                }

                playerRankingList.appendChild(listItem);
            });
        }



        function sortPlayersRanking() {
            const sortBy = document.getElementById('sort-by').value;
             const rankingType = document.getElementById('ranking-type').value;
            renderPlayerRanking(sortBy,rankingType);
        }

        function renderRankings() {
            const rankingType = document.getElementById('ranking-type').value;
            renderTeamRanking(rankingType);
            renderPlayerRanking('points', rankingType); // Default ordinamento per punti
        }

        // Funzione per mostrare/nascondere le sezioni
        function showSection(sectionId) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.style.display = 'none');
            document.getElementById(sectionId).style.display = 'block';
        }

        // Inizializzazione
        window.onload = function() {
            renderPlayers();
            renderSelectedPlayers();
            renderRankings();
            showSection('teamBuilder'); // Mostra la sezione "Team Builder" di default
        };

    </script>
</body>
</html>
