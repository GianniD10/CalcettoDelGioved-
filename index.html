
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Calcio a 5</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Resetta gli stili predefiniti */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Variabili di stile aggiornate */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --primary-color: #667eea;
            --secondary-color: #2c3e50;
            --success-color: #00f2fe;
            --error-color: #fa709a;
            --light-bg: #f8fafc;
            --dark-bg: #e2e8f0;
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-color: #2d3748;
            --text-muted: #718096;
            --white: #ffffff;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 8px 25px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 25px 60px rgba(0, 0, 0, 0.12);
            --border-radius: 16px;
            --border-radius-lg: 24px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--primary-gradient);
            background-attachment: fixed;
            min-height: 100vh;
            color: var(--text-color);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        /* Effetto parallax per lo sfondo */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            padding: 40px;
            box-shadow: var(--shadow-xl);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
        }

        h1 {
            text-align: center;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 40px;
            font-size: 3rem;
            font-weight: 800;
            letter-spacing: -0.02em;
            position: relative;
        }

        h1::after {
            content: '‚öΩ';
            position: absolute;
            top: -10px;
            right: -40px;
            font-size: 2rem;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .menu {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
        }

        .menu button {
            padding: 16px 32px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            background: var(--primary-gradient);
            color: var(--white);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .menu button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .menu button:hover::before {
            left: 100%;
        }

        .menu button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .menu button:active {
            transform: translateY(0);
        }

        /* Layout principale migliorato */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: 40px;
        }

        .section {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .players-section, .team-section, .rankings-section {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 32px;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .players-section::before, .team-section::before, .rankings-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--success-gradient);
        }

        .players-section h2, .team-section h3, .rankings-section h2 {
            color: var(--text-color);
            margin-bottom: 24px;
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Card giocatori ridisegnate */
        .player-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, var(--light-bg) 0%, var(--white) 100%);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .player-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.6s;
        }

        .player-card:hover::before {
            left: 100%;
        }

        .player-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }

        .player-card.selected {
            background: var(--primary-gradient);
            color: var(--white);
            transform: scale(1.05);
            box-shadow: var(--shadow-xl);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .player-card.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: #f8f9fa;
            filter: grayscale(1);
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .player-avatar {
            width: 48px;
            height: 48px;
            background: var(--primary-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 700;
            font-size: 18px;
            box-shadow: var(--shadow-sm);
            position: relative;
        }

        .player-avatar::after {
            content: '';
            position: absolute;
            inset: -2px;
            background: var(--primary-gradient);
            border-radius: 50%;
            z-index: -1;
            opacity: 0;
            transition: var(--transition);
        }

        .player-card:hover .player-avatar::after {
            opacity: 0.3;
            transform: scale(1.2);
        }

        .player-card.selected .player-avatar {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
        }

        .player-name {
            font-weight: 600;
            font-size: 1.1rem;
            letter-spacing: -0.01em;
        }

        .player-cost {
            background: var(--danger-gradient);
            color: var(--white);
            padding: 10px 18px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 1rem;
            min-width: 70px;
            text-align: center;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .player-cost::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: var(--transition);
        }

        .player-card:hover .player-cost::before {
            width: 100%;
            height: 100%;
        }

        .player-card.selected .player-cost {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
        }

        /* Sezione team migliorata */
        .budget-info {
            background: var(--success-gradient);
            color: var(--white);
            padding: 28px;
            border-radius: var(--border-radius);
            margin-bottom: 32px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .budget-info::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .budget-info h3 {
            font-size: 1.2rem;
            margin-bottom: 12px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        .budget-display {
            font-size: 2.5rem;
            font-weight: 800;
            position: relative;
            z-index: 1;
        }

        .team-list {
            min-height: 200px;
            margin-bottom: 32px;
        }

        .selected-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: linear-gradient(135deg, var(--light-bg) 0%, var(--white) 100%);
            border-radius: var(--border-radius);
            margin-bottom: 12px;
            transition: var(--transition);
            border-left: 4px solid var(--primary-color);
        }

        .selected-player:hover {
            transform: translateX(8px);
            box-shadow: var(--shadow-md);
        }

        .remove-btn {
            background: var(--danger-gradient);
            color: var(--white);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .remove-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-md);
        }

        /* Pulsanti di azione ridisegnati */
        .action-buttons {
            display: flex;
            gap: 20px;
        }

        .btn {
            flex: 1;
            padding: 18px 28px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: var(--transition);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-reset {
            background: var(--danger-gradient);
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .btn-reset:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .btn-save {
            background: var(--success-gradient);
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .btn-save:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Stili per l'immagine della squadra */
        .team-image {
            display: none;
            position: fixed;
            top: -9999px;
            left: -9999px;
            width: 800px;
            height: 1000px;
            background: var(--primary-gradient);
            border-radius: 20px;
            padding: 40px;
            color: var(--white);
            text-align: center;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        .team-image h2 {
            font-size: 3rem;
            margin-bottom: 40px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            font-weight: 800;
        }

        .formation {
            display: flex;
            flex-direction: column;
            gap: 30px;
            min-height: 600px;
            position: relative;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(10px);
            justify-content: space-between;
        }

        .position-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .player-slot {
            background: rgba(255, 255, 255, 0.25);
            border: 3px solid rgba(255, 255, 255, 0.4);
            border-radius: 20px;
            padding: 20px 25px;
            color: var(--white);
            font-weight: bold;
            text-align: center;
            width: 280px;
            height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .player-slot .player-name {
            font-size: 1.4rem;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .player-slot .player-cost {
            font-size: 1.1rem;
            opacity: 0.9;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 15px;
        }

        .total-cost {
            background: rgba(255, 255, 255, 0.25);
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: center;
            font-size: 1.6rem;
            font-weight: bold;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        /* Notifiche migliorate */
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: var(--white);
            color: var(--text-color);
            padding: 20px 28px;
            border-radius: var(--border-radius);
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: var(--transition);
            box-shadow: var(--shadow-xl);
            border-left: 4px solid var(--success-color);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            border-left-color: var(--error-color);
        }

        /* Classifiche migliorate */
        .ranking-list {
            list-style: none;
            padding: 0;
        }

        .ranking-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            font-size: 1rem;
            padding: 16px 20px;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--light-bg) 0%, var(--white) 100%);
            border-radius: var(--border-radius);
            transition: var(--transition);
            border-left: 4px solid var(--primary-color);
        }

        .ranking-list li:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow-md);
        }

        .ranking-type-selection {
            margin-bottom: 32px;
            text-align: center;
        }

        .ranking-type-selection label {
            margin-right: 12px;
            font-weight: 600;
            color: var(--text-color);
        }

        .ranking-type-selection select, #sort-by {
            padding: 12px 20px;
            border-radius: var(--border-radius);
            border: 2px solid var(--light-bg);
            background: var(--white);
            font-weight: 500;
            transition: var(--transition);
        }

        .ranking-type-selection select:focus, #sort-by:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .rankings-section {
            display: none;
        }

        .rankings-section.active {
            display: block;
        }

        /* Responsive design migliorato */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            .container {
                padding: 24px;
                margin: 0;
            }

            h1 {
                font-size: 2.2rem;
                margin-bottom: 24px;
            }

            h1::after {
                right: -20px;
                font-size: 1.5rem;
            }

            .main-content {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .players-section, .team-section, .rankings-section {
                padding: 20px;
            }

            .menu {
                gap: 12px;
                flex-wrap: wrap;
            }

            .menu button {
                padding: 12px 24px;
                font-size: 0.9rem;
            }

            .player-card {
                padding: 16px 20px;
                margin-bottom: 10px;
            }

            .player-avatar {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .player-name {
                font-size: 1rem;
            }

            .budget-info {
                padding: 20px;
            }

            .budget-display {
                font-size: 2rem;
            }

            .selected-player {
                padding: 14px 16px;
            }

            .action-buttons {
                flex-direction: column;
                gap: 12px;
            }

            .btn {
                padding: 16px 24px;
                font-size: 0.9rem;
            }

            .ranking-list li {
                padding: 14px 16px;
                font-size: 0.9rem;
            }

            .notification {
                top: 20px;
                right: 20px;
                left: 20px;
                transform: translateY(-100px);
            }

            .notification.show {
                transform: translateY(0);
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 16px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .players-section, .team-section, .rankings-section {
                padding: 16px;
            }

            .player-card {
                padding: 12px 16px;
            }

            .budget-info {
                padding: 16px;
            }

            .budget-display {
                font-size: 1.8rem;
            }
        }

        /* Footer migliorato */
        footer {
            text-align: center;
            margin-top: 40px;
            color: rgba(255, 255, 255, 0.8);
            padding: 20px;
            font-weight: 500;
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.1);
        }

        /* Animazioni aggiuntive */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .player-card, .selected-player, .ranking-list li {
            animation: slideInUp 0.4s ease-out;
        }

        /* Effetti di hover globali */
        * {
            transition: var(--transition-fast);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Fantasy Calcio a 5</h1>

        <div class="menu">
            <button onclick="showSection('teamBuilder')">üèóÔ∏è Team Builder</button>
            <button onclick="showSection('rankings')">üèÜ Classifiche</button>
        </div>

        <div id="teamBuilder" class="section">
            <div class="main-content">
                <div class="players-section">
                    <h2>üë• Giocatori Disponibili</h2>
                    <div id="playersList"></div>
                </div>

                <div class="team-section">
                    <div class="budget-info">
                        <h3>üí∞ Budget Rimanente</h3>
                        <div class="budget-display"><span id="remainingBudget">25</span> crediti</div>
                    </div>

                    <div class="team-list">
                        <h3>üèÜ La Tua Squadra (<span id="teamCount">0</span>/5)</h3>
                        <div id="selectedPlayers"></div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-reset" onclick="resetTeam()">üîÑ Reset</button>
                        <button class="btn btn-save" id="saveBtn" onclick="saveTeamImage()" disabled>üíæ Salva Immagine</button>
                    </div>
                </div>
            </div>

            <div class="team-image" id="teamImage">
                <h2>üèÜ LA MIA SQUADRA</h2>
                <div class="formation" id="formation"></div>
                <div class="total-cost">
                    Costo Totale: <span id="totalCostDisplay">0</span> crediti
                </div>
            </div>
        </div>

        <div id="rankings" class="rankings-section section">
            <h2>üèÜ Classifiche</h2>

            <div class="ranking-type-selection">
                <label for="ranking-type">Tipo di Classifica:</label>
                <select id="ranking-type" onchange="renderRankings()">
                    <option value="weekly">üìÖ Settimanale</option>
                    <option value="global">üåç Globale</option>
                </select>
            </div>

            <div class="rankings-container">
                <div class="team-rankings">
                    <h3>üèÖ Classifica Squadre</h3>
                    <ul class="ranking-list" id="teamRankingList"></ul>
                </div>
                <br><br>
                <div class="player-rankings">
                    <h3>‚≠ê Classifica Giocatori</h3>
                    <label for="sort-by">Ordina per:</label>
                    <select id="sort-by" onchange="sortPlayersRanking()">
                        <option value="points">üéØ Punteggio</option>
                        <option value="average">üìä Media</option>
                    </select>
                    <ul class="ranking-list" id="playerRankingList"></ul>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <footer>
        &copy; 2025 Fantasy Calcio a 5 - Bob Difensore 7 ‚öΩ
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // Dati dei giocatori
        const players = [
            { name: "Luigi Pedone", cost: 9 },
            { name: "Gianni Destino", cost: 8 },
            { name: "Giuseppe Acquaviva", cost: 7 },
            { name: "Francesco Matarrese ", cost: 7 },
            { name: "Domenico Patruno", cost: 6 },
            { name: "Mariano Di Nicoli", cost: 5 },
            { name: "Simone Palermo", cost: 4 },
            { name: "Luca Di Muro", cost: 3 },
            { name: "Leo Acquaviva", cost: 3 },
            { name: "Biagio Barbarossa", cost: 3 },
            { name: "Nicola Iacobone", cost: 2 },
            { name: "Luca 'Bob' Del Vento", cost: 2 }
        ];

        // Dati delle Classifiche (iniziali)
        const weeklyTeamRankingData = [
            { name: "PEDONE", score: 14 },
            { name: "DI NICOLI", score: 13.5 },
            { name: "DI MURO", score: 13.5 },
            { name: "IACOBONE", score: 13.5 },
            { name: "MATARRESE", score: 13 },
            { name: "PALERMO", score: 13 },
            { name: "DESTINO", score: 11.5 },
            { name: "BARBAROSSA", score: 11.5 },
            { name: "ACQUAVIVA", score: 10.5 },
            { name: "DEL VENTO", score: 10 },
            { name: "PATRUNO", score: 8.5 }
        ];

        const globalTeamRankingData = [
            { name: "PEDONE", score: 14 },
            { name: "DI NICOLI", score: 13.5 },
            { name: "DI MURO", score: 13.5 },
            { name: "IACOBONE", score: 13.5 },
            { name: "MATARRESE", score: 13 },
            { name: "PALERMO", score: 13 },
            { name: "DESTINO", score: 11.5 },
            { name: "BARBAROSSA", score: 11.5 },
            { name: "ACQUAVIVA", score: 10.5 },
            { name: "DEL VENTO", score: 10 },
            { name: "PATRUNO", score: 8.5 }
        ];

        const weeklyPlayerRankingData = [
            { name: "Destino G.", score: 6.5, matches: 1 },
            { name: "Matarrese F.", score: 6.0, matches: 1},
            { name: "Pedone L.", score: 2.0, matches: 1 },
            { name: "Acquaviva G.", score: 3.5, matches: 1 },
            { name: "Di Nicoli M.", score: 2.5, matches: 1 },
            { name: "Patruno D.", score: 1.5, matches: 1 },
            { name: "Di Muro L.", score: 1.5, matches: 1 },
            { name: "Barbarossa B.", score: 1.5, matches: 1 },
            { name: "Iacobone N.", score: 0.0, matches: 1 },
            { name: "Del Vento L.", score: 2.5, matches: 1 }
        ];

        const globalPlayerRankingData = [
            { name: "Pedone L.", score: 19.0, matches: 4 },
            { name: "Destino G.", score: 18.5, matches: 4 },
            { name: "Acquaviva G.", score: 12.0, matches: 4 },
            { name: "Matarrese F.", score: 12.0, matches: 3 },
            { name: "Di Nicoli M.", score: 9.0, matches: 4 },
            { name: "Patruno D.", score: 7.5, matches: 4 },
            { name: "Palermo S.", score: 4.5, matches: 3 },
            { name: "Di Muro L.", score: 4.5, matches: 4 },
            { name: "Acquaviva L.", score: 2.0, matches: 1 },
            { name: "Barbarossa B.", score: 1.5, matches: 1 },
            { name: "Iacobone N.", score: 1.5, matches: 3 },
            { name: "Di Fazio L", score: 1.0, matches: 1 },
            { name: "Del Vento L.", score: -0.5, matches: 4 }
        ];

        // Variabili di stato
        let selectedPlayers = [];
        let remainingBudget = 25;

        // Funzioni di utilit√†
        function getInitials(name) {
            return name.split(' ').map(word => word[0]).join('').toUpperCase();
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Funzioni per la gestione della squadra
        function renderPlayers() {
            const playersList = document.getElementById('playersList');
            playersList.innerHTML = '';

            players.forEach((player, index) => {
                const isSelected = selectedPlayers.some(p => p.name === player.name);
                const canAfford = player.cost <= remainingBudget;
                const isDisabled = !isSelected && (!canAfford || selectedPlayers.length >= 5);

                const playerCard = document.createElement('div');
                playerCard.className = `player-card ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}`;
                playerCard.onclick = () => togglePlayer(player);

                playerCard.innerHTML = `
                    <div class="player-info">
                        <div class="player-avatar">${getInitials(player.name)}</div>
                        <div class="player-name">${player.name}</div>
                    </div>
                    <div class="player-cost">${player.cost}</div>
                `;

                playersList.appendChild(playerCard);
            });
        }

        function togglePlayer(player) {
            const isSelected = selectedPlayers.some(p => p.name === player.name);

            if (isSelected) {
                selectedPlayers = selectedPlayers.filter(p => p.name !== player.name);
                remainingBudget += player.cost;
            } else {
                if (selectedPlayers.length >= 5) {
                    showNotification('Hai gi√† selezionato 5 giocatori!', 'error');
                    return;
                }
                if (player.cost > remainingBudget) {
                    showNotification('Budget insufficiente!', 'error');
                    return;
                }
                selectedPlayers.push(player);
                remainingBudget -= player.cost;
            }

            updateUI();
        }

        function renderSelectedPlayers() {
            const selectedPlayersDiv = document.getElementById('selectedPlayers');
            selectedPlayersDiv.innerHTML = '';

            if (selectedPlayers.length === 0) {
                selectedPlayersDiv.innerHTML = '<p style="text-align: center; color: #7f8c8d; font-style: italic;">Nessun giocatore selezionato</p>';
                return;
            }

            selectedPlayers.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'selected-player';
                playerDiv.innerHTML = `
                    <span><strong>${player.name}</strong> (${player.cost} crediti)</span>
                    <button class="remove-btn" onclick="togglePlayer({name: '${player.name}', cost: ${player.cost}})">‚úï</button>
                `;
                selectedPlayersDiv.appendChild(playerDiv);
            });
        }

        function resetTeam() {
            selectedPlayers = [];
            remainingBudget = 25;
            updateUI();
            showNotification('Squadra resettata!');
        }

        function updateUI() {
            document.getElementById('remainingBudget').textContent = remainingBudget;
            document.getElementById('teamCount').textContent = selectedPlayers.length;

            const saveBtn = document.getElementById('saveBtn');
            saveBtn.disabled = selectedPlayers.length !== 5;

            renderPlayers();
            renderSelectedPlayers();
        }

        function saveTeamImage() {
            if (selectedPlayers.length !== 5) {
                showNotification('Devi selezionare esattamente 5 giocatori!', 'error');
                return;
            }

            const teamImage = document.getElementById('teamImage');
            const formation = document.getElementById('formation');

            // Crea la formazione 2-1-1-1 (portiere - difensori - centrocampista - attaccante)
            formation.innerHTML = '';

            const positions = [
                { label: 'ATTACCANTE', players: 1 },
                { label: 'CENTROCAMPISTA', players: 1 },
                { label: 'CENTROCAMPISTA', players: 1 },
                { label: 'DIFENSORI', players: 2 }
            ];

            let playerIndex = 0;
            positions.forEach(position => {
                const row = document.createElement('div');
                row.className = 'position-row';

                for (let i = 0; i < position.players; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'player-slot';

                    if (playerIndex < selectedPlayers.length) {
                        const player = selectedPlayers[playerIndex];
                        slot.innerHTML = `
                            <div class="player-name">${player.name}</div>
                            <div class="player-cost">${player.cost} crediti</div>
                        `;
                        playerIndex++;
                    } else {
                        slot.innerHTML = `<div class="player-name">${position.label}</div>`;
                    }

                    row.appendChild(slot);
                }

                formation.appendChild(row);
            });

            const totalCost = selectedPlayers.reduce((sum, player) => sum + player.cost, 0);
            document.getElementById('totalCostDisplay').textContent = totalCost;

            // Mostra temporaneamente l'elemento per la cattura
            teamImage.style.display = 'block';
            teamImage.style.position = 'fixed';
            teamImage.style.top = '-9999px';
            teamImage.style.left = '-9999px';

            // Aspetta un momento per il rendering, poi cattura con impostazioni ottimizzate
            setTimeout(() => {
                html2canvas(teamImage, {
                    backgroundColor: null,
                    scale: 1,
                    width: 800,
                    height: 1000,
                    useCORS: true,
                    allowTaint: true,
                    logging: false,
                    scrollX: 0,
                    scrollY: 0,
                    windowWidth: 800,
                    windowHeight: 1000
                }).then(canvas => {
                    // Crea un canvas ottimizzato per mobile
                    const optimizedCanvas = document.createElement('canvas');
                    const ctx = optimizedCanvas.getContext('2d');

                    // Dimensioni ottimali per mobile (16:10 ratio)
                    optimizedCanvas.width = 800;
                    optimizedCanvas.height = 1000;

                    // Disegna l'immagine catturata sul canvas ottimizzato
                    ctx.fillStyle = '#667eea';
                    ctx.fillRect(0, 0, 800, 1000);
                    ctx.drawImage(canvas, 0, 0, 800, 1000);

                    // Scarica l'immagine ottimizzata
                    const link = document.createElement('a');
                    link.download = 'la_mia_squadra_calcio5.png';
                    link.href = optimizedCanvas.toDataURL('image/png', 1.0);

                    // Per mobile, usa un approccio diverso
                    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                        // Apri in una nuova finestra per mobile
                        const newWindow = window.open('', '_blank');
                        newWindow.document.write(`
                            <html>
                                <head>
                                    <title>La Mia Squadra</title>
                                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                                    <style>
                                        body { margin: 0; padding: 20px; text                                         img { max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
                                        .download-btn {
                                            display: inline-block;
                                            margin-top: 20px;
                                            padding: 15px 30px;
                                            background: #3498db;
                                            color: white;
                                            text-decoration: none;
                                            border-radius: 10px;
                                            font-weight: bold;
                                        }
                                    </style>
                                </head>
                                <body>
                                    <h2>üèÜ La Tua Squadra √® Pronta!</h2>
                                    <img src="${optimizedCanvas.toDataURL('image/png', 1.0)}" alt="La Mia Squadra">
                                    <br>
                                    <a href="${optimizedCanvas.toDataURL('image/png', 1.0)}" download="la_mia_squadra_calcio5.png" class="download-btn">
                                        üì± Salva Immagine
                                    </a>
                                    <p style="margin-top: 20px; color: #666;">
                                        Tieni premuto sull'immagine e seleziona "Salva immagine" dal menu
                                    </p>
                                </body>
                            </html>
                        `);
                    } else {
                        // Desktop: download diretto
                        link.click();
                    }

                    teamImage.style.display = 'none';
                    showNotification('Immagine creata con successo! üéâ');
                }).catch(err => {
                    console.error('Errore nel salvare l\'immagine:', err);
                    showNotification('Errore nel salvare l\'immagine', 'error');
                    teamImage.style.display = 'none';
                });
            }, 500);
        }

        // Funzioni per la gestione delle classifiche
        function renderTeamRanking(rankingType = 'weekly') {
            const teamRankingList = document.getElementById('teamRankingList');
            teamRankingList.innerHTML = '';

            const rankingData = (rankingType === 'weekly') ? weeklyTeamRankingData : globalTeamRankingData;

            rankingData.forEach(team => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span>${team.name}</span><span>${team.score}</span>`;
                teamRankingList.appendChild(listItem);
            });
        }

        function renderPlayerRanking(sortBy = 'points', rankingType = 'weekly') {
            const playerRankingList = document.getElementById('playerRankingList');
            playerRankingList.innerHTML = '';

            const rankingData = (rankingType === 'weekly') ? weeklyPlayerRankingData : globalPlayerRankingData;

            let sortedPlayers = [...rankingData];
            if (sortBy === 'points') {
                sortedPlayers.sort((a, b) => b.score - a.score);
            } else if (sortBy === 'average') {
                sortedPlayers.sort((a, b) => (b.score / b.matches) - (a.score / a.matches));
            }

            sortedPlayers.forEach(player => {
                const listItem = document.createElement('li');

                if (rankingType === 'weekly') {
                    // Solo nome e punteggio
                    listItem.innerHTML = `<span>${player.name}</span><span>${player.score}</span>`;
                } else {
                    // Nome, punteggio, partite e media
                    const average = (player.score / player.matches).toFixed(2);
                    listItem.innerHTML = `<span>${player.name}</span><span>${player.score} (${player.matches} partite, Media: ${average})</span>`;
                }

                playerRankingList.appendChild(listItem);
            });
        }



        function sortPlayersRanking() {
            const sortBy = document.getElementById('sort-by').value;
             const rankingType = document.getElementById('ranking-type').value;
            renderPlayerRanking(sortBy,rankingType);
        }

        function renderRankings() {
            const rankingType = document.getElementById('ranking-type').value;
            renderTeamRanking(rankingType);
            renderPlayerRanking('points', rankingType); // Default ordinamento per punti
        }

        // Funzione per mostrare/nascondere le sezioni
        function showSection(sectionId) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.style.display = 'none');
            document.getElementById(sectionId).style.display = 'block';
        }

        // Inizializzazione
        window.onload = function() {
            renderPlayers();
            renderSelectedPlayers();
            renderRankings();
            showSection('teamBuilder'); // Mostra la sezione "Team Builder" di default
        };

    </script>
</body>
</html>
