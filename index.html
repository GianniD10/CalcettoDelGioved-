<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Calcio a 5</title>
    <style>
        /* Stili CSS (come fornito in precedenza, con aggiunte) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 30px;
        }

        .players-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        .players-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .player-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .player-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            border-color: #3498db;
        }

        .player-card.selected {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            transform: scale(1.02);
            box-shadow: 0 10px 25px rgba(52, 152, 219, 0.3);
        }

        .player-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f1f2f6;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        .player-card.selected .player-avatar {
            background: rgba(255, 255, 255, 0.2);
        }

        .player-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .player-cost {
            background: #e74c3c;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1rem;
            min-width: 60px;
            text-align: center;
        }

        .player-card.selected .player-cost {
            background: rgba(255, 255, 255, 0.2);
        }

        .team-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 20px;
        }

        .budget-info {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: center;
        }

        .budget-info h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .budget-display {
            font-size: 2rem;
            font-weight: bold;
        }

        .team-list {
            min-height: 300px;
            margin-bottom: 20px;
        }

        .team-list h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .selected-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .selected-player:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .remove-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .remove-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-reset {
            background: #e74c3c;
            color: white;
        }

        .btn-reset:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.3);
        }

        .btn-save {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .team-image {
            display: none;
            position: fixed;
            top: -9999px;
            left: -9999px;
            width: 800px;
            height: 1000px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 40px;
            color: white;
            text-align: center;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .team-image h2 {
            font-size: 3rem;
            margin-bottom: 40px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            font-weight: 700;
        }

        .formation {
            display: flex;
            flex-direction: column;
            gap: 30px;
            min-height: 600px;
            position: relative;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(5px);
            justify-content: space-between;
        }

        .position-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .player-slot {
            background: rgba(255, 255, 255, 0.25);
            border: 3px solid rgba(255, 255, 255, 0.4);
            border-radius: 20px;
            padding: 20px 25px;
            color: white;
            font-weight: bold;
            text-align: center;
            width: 280px;
            height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .player-slot .player-name {
            font-size: 1.4rem;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .player-slot .player-cost {
            font-size: 1.1rem;
            opacity: 0.9;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 15px;
        }

        .total-cost {
            background: rgba(255, 255, 255, 0.25);
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: center;
            font-size: 1.6rem;
            font-weight: bold;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .container {
                padding: 20px;
            }

            h1 {
                font-size: 2rem;
            }

            .action-buttons {
                flex-direction: column;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #e74c3c;
        }

        /* Stili per le classifiche */
        .rankings-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            margin-top: 20px;
        }

        .rankings-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .ranking-list {
            list-style: none;
            padding: 0;
        }

        .ranking-list li {
            padding: 10px 15px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ranking-list li:last-child {
            border-bottom: none;
        }

        /* Style for the media selection dropdown */
        #sort-by {
            margin-left: 10px;
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
        }

        /* Styles for the menu */
        .menu {
            text-align: center;
            margin-bottom: 20px;
        }

        .menu button {
            padding: 10px 20px;
            font-size: 1rem;
            border: none;
            border-radius: 5px;
            background-color: #3498db;
            color: white;
            cursor: pointer;
            margin: 0 10px;
            transition: background-color 0.3s ease;
        }

        .menu button:hover {
            background-color: #2980b9;
        }

        /* Style for the ranking section */
        .rankings-section {
            display: none; /* Hidden by default */
        }

        /* Style to show the ranking section */
        .rankings-section.active {
            display: block;
        }

        /* Styles for the ranking type selection */
        .ranking-type-selection {
            margin-bottom: 20px;
            text-align: center;
        }

        .ranking-type-selection label {
            margin-right: 10px;
            font-weight: bold;
        }

        .ranking-type-selection select {
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>⚽ Fantasy Calcio a 5</h1>

        <div class="menu">
            <button onclick="showSection('teamBuilder')">Team Builder</button>
            <button onclick="showSection('rankings')">Classifiche</button>
        </div>

        <div id="teamBuilder" class="section">
            <div class="main-content">
                <div class="players-section">
                    <h2>👥 Giocatori Disponibili</h2>
                    <div id="playersList"></div>
                </div>

                <div class="team-section">
                    <div class="budget-info">
                        <h3>💰 Budget Rimanente</h3>
                        <div class="budget-display"><span id="remainingBudget">25</span> crediti</div>
                    </div>

                    <div class="team-list">
                        <h3>🏆 La Tua Squadra (<span id="teamCount">0</span>/5)</h3>
                        <div id="selectedPlayers"></div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-reset" onclick="resetTeam()">🔄 Reset</button>
                        <button class="btn btn-save" id="saveBtn" onclick="saveTeamImage()" disabled>💾 Salva Immagine</button>
                    </div>
                </div>
            </div>

            <div class="team-image" id="teamImage">
                <h2>🏆 LA MIA SQUADRA</h2>
                <div class="formation" id="formation"></div>
                <div class="total-cost">
                    Costo Totale: <span id="totalCostDisplay">0</span> crediti
                </div>
            </div>
        </div>

        <div id="rankings" class="rankings-section section">
            <h2>🏆 Classifiche</h2>

            <div class="ranking-type-selection">
                <label for="ranking-type">Tipo di Classifica:</label>
                <select id="ranking-type" onchange="renderRankings()">
                    <option value="weekly">Settimanale</option>
                    <option value="global">Globale</option>
                </select>
            </div>

            <div class="rankings-container">
                <!-- Classifica Squadre -->
                <div class="team-rankings">
                    <h3>Classifica Squadre</h3>
                    <ul class="ranking-list" id="teamRankingList"></ul>
                </div>
<br> <br>
                <!-- Classifica Giocatori -->
                <div class="player-rankings">
                    <h3>Classifica Giocatori</h3> <br>
                    <label for="sort-by">Ordina per:</label>
                    <select id="sort-by" onchange="sortPlayersRanking()">
                        <option value="points">Punteggio</option>
                        <option value="average">Media</option>
                    </select>
                    <ul class="ranking-list" id="playerRankingList"></ul>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // Dati dei giocatori
        const players = [
            { name: "Luigi Pedone", cost: 9 },
            { name: "Gianni Destino", cost: 8 },
            { name: "Giuseppe Acquaviva", cost: 7 },
            { name: "Francesco Pio Matarrese", cost: 7 },
            { name: "Domenico Patruno", cost: 6 },
            { name: "Mariano Di Nicoli", cost: 5 },
            { name: "Simone Palermo", cost: 4 },
            { name: "Luca Di Muro", cost: 3 },
            { name: "Leo Acquaviva", cost: 3 },
            { name: "Biagio Barbarossa", cost: 3 },
            { name: "Nicola Iacobone", cost: 2 },
            { name: "Luca 'Bob' Del Vento", cost: 2 }
        ];

        // Dati delle Classifiche (iniziali)
        const weeklyTeamRankingData = [
            { name: "PEDONE", score: 14 },
            { name: "DI NICOLI", score: 13.5 },
            { name: "DI MURO", score: 13.5 },
            { name: "IACOBONE", score: 13.5 },
            { name: "MATARRESE", score: 13 },
            { name: "PALERMO", score: 13 },
            { name: "DESTINO", score: 11.5 },
            { name: "BARBAROSSA", score: 11.5 },
            { name: "ACQUAVIVA", score: 10.5 },
            { name: "DEL VENTO", score: 10 },
            { name: "PATRUNO", score: 8.5 }
        ];

        const globalTeamRankingData = [
            { name: "PEDONE", score: 14 },
            { name: "DI NICOLI", score: 13.5 },
            { name: "DI MURO", score: 13.5 },
            { name: "IACOBONE", score: 13.5 },
            { name: "MATARRESE", score: 13 },
            { name: "PALERMO", score: 13 },
            { name: "DESTINO", score: 11.5 },
            { name: "BARBAROSSA", score: 11.5 },
            { name: "ACQUAVIVA", score: 10.5 },
            { name: "DEL VENTO", score: 10 },
            { name: "PATRUNO", score: 8.5 }
        ];

        const weeklyPlayerRankingData = [
            { name: "Luigi Pedone", score: 19.0, matches: 4 },
            { name: "Gianni Destino", score: 18.5, matches: 4 },
            { name: "Giuseppe Acquaviva", score: 12.0, matches: 4 },
            { name: "Francesco Pio Matarrese", score: 12.0, matches: 3 },
            { name: "Mariano Di Nicoli", score: 9.0, matches: 4 },
            { name: "Domenico Patruno", score: 7.5, matches: 4 },
            { name: "Simone Palermo", score: 4.5, matches: 3 },
            { name: "Luca Di Muro", score: 4.5, matches: 4 },
            { name: "Leo Acquaviva", score: 2.0, matches: 1 },
            { name: "Biagio Barbarossa", score: 1.5, matches: 1 },
            { name: "Nicola Iacobone", score: 1.5, matches: 3 },
            { name: "Luca Di Fazio", score: 1.0, matches: 1 },
            { name: "Luca Del Vento", score: -0.5, matches: 4 }
        ];

        const globalPlayerRankingData = [
            { name: "Luigi Pedone", score: 19.0, matches: 4 },
            { name: "Gianni Destino", score: 18.5, matches: 4 },
            { name: "Giuseppe Acquaviva", score: 12.0, matches: 4 },
            { name: "Francesco Pio Matarrese", score: 12.0, matches: 3 },
            { name: "Mariano Di Nicoli", score: 9.0, matches: 4 },
            { name: "Domenico Patruno", score: 7.5, matches: 4 },
            { name: "Simone Palermo", score: 4.5, matches: 3 },
            { name: "Luca Di Muro", score: 4.5, matches: 4 },
            { name: "Leo Acquaviva", score: 2.0, matches: 1 },
            { name: "Biagio Barbarossa", score: 1.5, matches: 1 },
            { name: "Nicola Iacobone", score: 1.5, matches: 3 },
            { name: "Luca Di Fazio", score: 1.0, matches: 1 },
            { name: "Luca Del Vento", score: -0.5, matches: 4 }
        ];

        // Variabili di stato
        let selectedPlayers = [];
        let remainingBudget = 25;

        // Funzioni di utilità
        function getInitials(name) {
            return name.split(' ').map(word => word[0]).join('').toUpperCase();
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Funzioni per la gestione della squadra
        function renderPlayers() {
            const playersList = document.getElementById('playersList');
            playersList.innerHTML = '';

            players.forEach((player, index) => {
                const isSelected = selectedPlayers.some(p => p.name === player.name);
                const canAfford = player.cost <= remainingBudget;
                const isDisabled = !isSelected && (!canAfford || selectedPlayers.length >= 5);

                const playerCard = document.createElement('div');
                playerCard.className = `player-card ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}`;
                playerCard.onclick = () => togglePlayer(player);

                playerCard.innerHTML = `
                    <div class="player-info">
                        <div class="player-avatar">${getInitials(player.name)}</div>
                        <div class="player-name">${player.name}</div>
                    </div>
                    <div class="player-cost">${player.cost}</div>
                `;

                playersList.appendChild(playerCard);
            });
        }

        function togglePlayer(player) {
            const isSelected = selectedPlayers.some(p => p.name === player.name);

            if (isSelected) {
                selectedPlayers = selectedPlayers.filter(p => p.name !== player.name);
                remainingBudget += player.cost;
            } else {
                if (selectedPlayers.length >= 5) {
                    showNotification('Hai già selezionato 5 giocatori!', 'error');
                    return;
                }
                if (player.cost > remainingBudget) {
                    showNotification('Budget insufficiente!', 'error');
                    return;
                }
                selectedPlayers.push(player);
                remainingBudget -= player.cost;
            }

            updateUI();
        }

        function renderSelectedPlayers() {
            const selectedPlayersDiv = document.getElementById('selectedPlayers');
            selectedPlayersDiv.innerHTML = '';

            if (selectedPlayers.length === 0) {
                selectedPlayersDiv.innerHTML = '<p style="text-align: center; color: #7f8c8d; font-style: italic;">Nessun giocatore selezionato</p>';
                return;
            }

            selectedPlayers.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'selected-player';
                playerDiv.innerHTML = `
                    <span><strong>${player.name}</strong> (${player.cost} crediti)</span>
                    <button class="remove-btn" onclick="togglePlayer({name: '${player.name}', cost: ${player.cost}})">✕</button>
                `;
                selectedPlayersDiv.appendChild(playerDiv);
            });
        }

        function resetTeam() {
            selectedPlayers = [];
            remainingBudget = 25;
            updateUI();
            showNotification('Squadra resettata!');
        }

        function updateUI() {
            document.getElementById('remainingBudget').textContent = remainingBudget;
            document.getElementById('teamCount').textContent = selectedPlayers.length;

            const saveBtn = document.getElementById('saveBtn');
            saveBtn.disabled = selectedPlayers.length !== 5;

            renderPlayers();
            renderSelectedPlayers();
        }

        function saveTeamImage() {
            if (selectedPlayers.length !== 5) {
                showNotification('Devi selezionare esattamente 5 giocatori!', 'error');
                return;
            }

            const teamImage = document.getElementById('teamImage');
            const formation = document.getElementById('formation');

            // Crea la formazione 2-1-1-1 (portiere - difensori - centrocampista - attaccante)
            formation.innerHTML = '';

            const positions = [
                { label: 'ATTACCANTE', players: 1 },
                { label: 'CENTROCAMPISTA', players: 1 },
                { label: 'CENTROCAMPISTA', players: 1 },
                { label: 'DIFENSORI', players: 2 }
            ];

            let playerIndex = 0;
            positions.forEach(position => {
                const row = document.createElement('div');
                row.className = 'position-row';

                for (let i = 0; i < position.players; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'player-slot';

                    if (playerIndex < selectedPlayers.length) {
                        const player = selectedPlayers[playerIndex];
                        slot.innerHTML = `
                            <div class="player-name">${player.name}</div>
                            <div class="player-cost">${player.cost} crediti</div>
                        `;
                        playerIndex++;
                    } else {
                        slot.innerHTML = `<div class="player-name">${position.label}</div>`;
                    }

                    row.appendChild(slot);
                }

                formation.appendChild(row);
            });

            const totalCost = selectedPlayers.reduce((sum, player) => sum + player.cost, 0);
            document.getElementById('totalCostDisplay').textContent = totalCost;

            // Mostra temporaneamente l'elemento per la cattura
            teamImage.style.display = 'block';
            teamImage.style.position = 'fixed';
            teamImage.style.top = '-9999px';
            teamImage.style.left = '-9999px';

            // Aspetta un momento per il rendering, poi cattura con impostazioni ottimizzate
            setTimeout(() => {
                html2canvas(teamImage, {
                    backgroundColor: null,
                    scale: 1,
                    width: 800,
                    height: 1000,
                    useCORS: true,
                    allowTaint: true,
                    logging: false,
                    scrollX: 0,
                    scrollY: 0,
                    windowWidth: 800,
                    windowHeight: 1000
                }).then(canvas => {
                    // Crea un canvas ottimizzato per mobile
                    const optimizedCanvas = document.createElement('canvas');
                    const ctx = optimizedCanvas.getContext('2d');

                    // Dimensioni ottimali per mobile (16:10 ratio)
                    optimizedCanvas.width = 800;
                    optimizedCanvas.height = 1000;

                    // Disegna l'immagine catturata sul canvas ottimizzato
                    ctx.fillStyle = '#667eea';
                    ctx.fillRect(0, 0, 800, 1000);
                    ctx.drawImage(canvas, 0, 0, 800, 1000);

                    // Scarica l'immagine ottimizzata
                    const link = document.createElement('a');
                    link.download = 'la_mia_squadra_calcio5.png';
                    link.href = optimizedCanvas.toDataURL('image/png', 1.0);

                    // Per mobile, usa un approccio diverso
                    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                        // Apri in una nuova finestra per mobile
                        const newWindow = window.open('', '_blank');
                        newWindow.document.write(`
                            <html>
                                <head>
                                    <title>La Mia Squadra</title>
                                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                                    <style>
                                        body { margin: 0; padding: 20px; text-align: center; background: #f0f0f0; }
                                        img { max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
                                        .download-btn {
                                            display: inline-block;
                                            margin-top: 20px;
                                            padding: 15px 30px;
                                            background: #3498db;
                                            color: white;
                                            text-decoration: none;
                                            border-radius: 10px;
                                            font-weight: bold;
                                        }
                                    </style>
                                </head>
                                <body>
                                    <h2>🏆 La Tua Squadra è Pronta!</h2>
                                    <img src="${optimizedCanvas.toDataURL('image/png', 1.0)}" alt="La Mia Squadra">
                                    <br>
                                    <a href="${optimizedCanvas.toDataURL('image/png', 1.0)}" download="la_mia_squadra_calcio5.png" class="download-btn">
                                        📱 Salva Immagine
                                    </a>
                                    <p style="margin-top: 20px; color: #666;">
                                        Tieni premuto sull'immagine e seleziona "Salva immagine" dal menu
                                    </p>
                                </body>
                            </html>
                        `);
                    } else {
                        // Desktop: download diretto
                        link.click();
                    }

                    teamImage.style.display = 'none';
                    showNotification('Immagine creata con successo! 🎉');
                }).catch(err => {
                    console.error('Errore nel salvare l\'immagine:', err);
                    showNotification('Errore nel salvare l\'immagine', 'error');
                    teamImage.style.display = 'none';
                });
            }, 500);
        }

        // Funzioni per la gestione delle classifiche
        function renderTeamRanking(rankingType = 'weekly') {
            const teamRankingList = document.getElementById('teamRankingList');
            teamRankingList.innerHTML = '';

            const rankingData = (rankingType === 'weekly') ? weeklyTeamRankingData : globalTeamRankingData;

            rankingData.forEach(team => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span>${team.name}</span><span>${team.score}</span>`;
                teamRankingList.appendChild(listItem);
            });
        }

        function renderPlayerRanking(sortBy = 'points', rankingType = 'weekly') {
            const playerRankingList = document.getElementById('playerRankingList');
            playerRankingList.innerHTML = '';

             const rankingData = (rankingType === 'weekly') ? weeklyPlayerRankingData : globalPlayerRankingData;

            let sortedPlayers = [...rankingData];
            if (sortBy === 'points') {
                sortedPlayers.sort((a, b) => b.score - a.score);
            } else if (sortBy === 'average') {
                sortedPlayers.sort((a, b) => (b.score / b.matches) - (a.score / a.matches));
            }

            sortedPlayers.forEach(player => {
                const listItem = document.createElement('li');
                const average = (player.score / player.matches).toFixed(2);
                listItem.innerHTML = `<span>${player.name}</span><span>${player.score} (${player.matches} partite, Media: ${average})</span>`;
                playerRankingList.appendChild(listItem);
            });
        }

        function sortPlayersRanking() {
            const sortBy = document.getElementById('sort-by').value;
             const rankingType = document.getElementById('ranking-type').value;
            renderPlayerRanking(sortBy,rankingType);
        }

        function renderRankings() {
            const rankingType = document.getElementById('ranking-type').value;
            renderTeamRanking(rankingType);
            renderPlayerRanking('points', rankingType); // Default ordinamento per punti
        }

        // Funzione per mostrare/nascondere le sezioni
        function showSection(sectionId) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.style.display = 'none');
            document.getElementById(sectionId).style.display = 'block';
        }

        // Inizializzazione
        window.onload = function() {
            renderPlayers();
            renderSelectedPlayers();
            renderRankings();
            showSection('teamBuilder'); // Mostra la sezione "Team Builder" di default
        };

    </script>
</body>
</html>
